<!DOCTYPE html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>Waragraph Web</title>
  </head>
  <body>
    <canvas id="main_view" width=800 height=600></canvas>

    <canvas id="path_view" width=800 height=200></canvas>

    <script src='./module-workers-polyfill.min.js'></script>

    <script type="module">

      console.log("what");

      import * as Comlink from "https://unpkg.com/comlink/dist/esm/comlink.mjs";

      import { addPathViewerEventHandlers } from './path_viewer_ui.js';

      import init_module, * as wasm_bindgen from './pkg/web.js';

      console.log("okay");

      async function init() {
          const worker = new Worker("main_worker.js", { type: 'module' });

          worker.onmessage = (event) => {
              worker.onmessage = undefined;

              console.log("graph loaded");
              const obj = Comlink.wrap(worker);

              let canvas = document.getElementById('path_view');
              let offscreen = canvas.transferControlToOffscreen();

              let path_name = "gi|528476637:29857558-29915771";
              // let path_name = "S288C.chrI";

              // path_viewer.connectCanvas(Comlink.transfer(offscreen, [offscreen]));
              obj.createPathViewer(Comlink.transfer(offscreen, [offscreen]),
                                   path_name)
              .then((path_viewer) => {
                  path_viewer.setView(0, 1000);
                  path_viewer.sample();
                  // window.path_viewer = path_viewer;

                  addPathViewerEventHandlers(obj, path_viewer, canvas);
              });



              window.worker_obj = obj;
              
          };


      }

      init();

      
    </script>

  </body>
</html>

