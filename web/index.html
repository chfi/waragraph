<!DOCTYPE html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
    <title>Waragraph Web</title>
    <link rel="stylesheet" href="waragraph.css"/>
  </head>
  <body>


    <div style="display: none" class="root-grid root-sidebar-open" id="root-container">

      <div class="sidebar row justify-content-center" id="sidebar-container">
        <div class="sidebar-panel row" id="sidebar-bed"></div>
        <div class="sidebar-panel row" id="sidebar-controls"></div>
      </div>
      
      <div class="gutter-column gutter-column-sidebar"></div>

      <div class="viz-grid" id="viz-container">
        <div id="graph-viewer-container">
        </div>

        <div class="gutter-row gutter-row-1"></div>

        <div id="path-viewer-container" style="overscroll-behavior: none;">
          <div class="path-viewer-column" id="path-viewer-left-column">
          </div>

          <div class="gutter-column gutter-column-1"></div>

          <div class="path-viewer-column" id="path-viewer-right-column">
          </div>
        </div>
      </div>
    </div>

    <div id="canvas">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-auto text-center content p-6">
            <h1 id="title">Waragraph</h1> <!-- Title -->
          </div>
        </div>
    
        <div id="file-inputs" class="row justify-content-center" style="margin-top: 40px;">
          <div id="file-inputs" class="col-auto content">
            <div class="row justify-content-center mt-2 mb-4">
              <!-- GFA input -->
              <div class="col-md-5 mx-3 square-outline text-center my-auto">
                <div class="row">
                  <div class="col-12">
                    <img src="icons/upload.png" alt="File Icon" style="height: 150px;">
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <label for="gfa-file">Choose a GFA file</label>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <input type="file" id="gfa-file" name="gfa" accept=".gfa">
                  </div>
                </div>
              </div>
        
              <!-- TSV input -->
              <div class="col-md-5 mx-3 square-outline text-center my-auto">
                <div class="row">
                  <div class="col-12">
                    <img src="icons/upload.png" alt="File Icon" style="height: 150px;">
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <label for="layout-file">Choose a TSV layout file</label>
                  </div>
                </div>
                <div class="row">
                  <div class="col-12">
                    <input type="file" id="layout-file" name="layout" accept=".tsv">
                  </div>
                </div>
              </div>
            </div>
        
            <!-- Button row -->
            <div class="row">
              <div class="col-12 text-center">
                <button id="load-data" class="btn btn-dark">Load data</button>
              </div>
            </div>
          </div>
        
        </div>
      </div>
    </div>



    <div id="tooltip" role="tooltip"></div>

    <script type="module">
      import { initializeWaragraph } from './ts/waragraph';

      document.getElementById('load-data').addEventListener('click', async (ev) => {
          let gfa_file = document.getElementById("gfa-file").files[0];
          let tsv_file = document.getElementById("layout-file").files[0];

          if (gfa_file === undefined || tsv_file === undefined) {
              return;
          }

          const viz_root = document.getElementById('viz-container');

          document.getElementById('canvas').setAttribute('hidden', '');
          document.getElementById('root-container').style.removeProperty('display');

          const spinner_par = document.createElement('div');
          const spinner = document.createElement('div');
          const spinner_text = document.createElement('div');
          spinner.classList.add('lds-dual-ring');
          spinner_par.style.setProperty('grid-column', '1');
          spinner_par.style.setProperty('grid-row', '1');
          spinner_par.style.setProperty('align-self', 'center');
          spinner_par.style.setProperty('align-items', 'center');
          spinner_par.style.setProperty('text-align', 'center');
          spinner_par.style.setProperty('margin-left', 'auto');
          spinner_par.style.setProperty('margin-right', 'auto');

          spinner_text.style.setProperty('font-family', 'sans-serif');
          spinner_text.style.setProperty('text-align', 'justify');
          spinner_text.style.setProperty('width', '100%');
          spinner_text.innerHTML = 'Loading graph';

          spinner_par.append(spinner);
          spinner_par.append(spinner_text);

          viz_root.append(spinner_par);

          initializeWaragraph({
            gfa: gfa_file,

            graph_viewer: {
              graph_layout: tsv_file,
              data: "depth",
            },

            path_viewers: {
                path_names: '*',
                viewport: { name: 'global', coordinate_system: 'graph' },
                data: 'depth',
                threshold: 0.5,
                // color_above: { r: 1.0, g: 0.0, b: 0.0 },
                color_above: 'hash_path_name',
                color_below: { r: 0.0, g: 0.0, b: 0.0, a: 0.0 },
            }
          }).then((wg) => {
            spinner_par.remove();
          });
      });

    </script>
  </body>
</html>
